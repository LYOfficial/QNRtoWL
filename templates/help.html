<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ config.server_name }} - è‡ªåŠ©æœåŠ¡ç³»ç»Ÿ</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icon.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://chinese-fonts-cdn.deno.dev/packages/lxgwwenkaibright/dist/LXGWBright-Regular/result.css" rel="stylesheet" />
    <style>
        body {
            background-image: url('{{ config.background_image_url }}');
            background-size: cover;
            background-attachment: fixed;
            color: white;
            font-family: 'LXGW WenKai Bright';
        }
        .content-box {
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid #555;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2vh;
            margin-bottom: 2vh;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        .btn-minecraft {
            background-color: #5a9a5a;
            border-color: #4a8a4a;
            color: white;
        }
        .btn-minecraft:hover {
            background-color: #4a8a4a;
            border-color: #3a7a3a;
        }
        .btn-danger-minecraft {
            background-color: #d9534f;
            border-color: #d43f3a;
            color: white;
        }
        .btn-danger-minecraft:hover {
            background-color: #c9302c;
            border-color: #ac2925;
        }
        .btn-info-minecraft {
            background-color: #5bc0de;
            border-color: #46b8da;
            color: white;
        }
        .btn-info-minecraft:hover {
            background-color: #39b3d7;
            border-color: #269abc;
        }
        .status-online {
            color: #5cb85c;
            font-weight: bold;
        }
        .status-offline {
            color: #d9534f;
            font-weight: bold;
        }
        .alert-minecraft {
            background-color: rgba(0, 0, 0, 0.7);
            border: 2px solid #5a9a5a;
            color: white;
        }
        .alert-minecraft p {
            margin-bottom: 0.5rem;
        }
        .alert-minecraft h6 {
            margin-bottom: 1rem;
        }
        .content-box {
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid #555;
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2vh;
            margin-bottom: 2vh;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            margin-left: auto;
            margin-right: auto;
        }
        #serverInfo {
            max-height: 300px;
            overflow-y: auto;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .text-info {
            color: #5bc0de !important;
            text-decoration: none;
        }
        .text-info:hover {
            color: #39b3d7 !important;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™½åå•æŸ¥è¯¢åŒºåŸŸ -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="content-box">
                    <h1 class="text-center mb-4">{{ config.server_name }} - è‡ªåŠ©æœåŠ¡ç³»ç»Ÿ</h1>
                    <hr>
                    <h4>ç™½åå•æŸ¥è¯¢</h4>
                    <p>è¯·è¾“å…¥æ‚¨çš„ Minecraft æ¸¸æˆIDï¼Œæ£€æŸ¥æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼š</p>
                    <div class="row">
                        <div class="col-md-8">
                            <input type="text" id="playerIdInput" class="form-control" placeholder="è¯·è¾“å…¥æ‚¨çš„ Minecraft æ¸¸æˆID">
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-minecraft w-100" onclick="checkWhitelist()">æŸ¥è¯¢ç™½åå•</button>
                        </div>
                    </div>
                    <div id="whitelistResult" class="mt-3"></div>
                    
                    <!-- ç™½åå•ç”³è¯·æ³¨æ„äº‹é¡¹ -->
                    <div class="mt-4">
                        <div class="alert alert-minecraft">
                            <h6>ğŸ“‹ ç™½åå•ç”³è¯·æ³¨æ„äº‹é¡¹</h6>
                            <p>ç”³è¯·ç™½åå•æ—¶åˆ‡è®°é€‰æ‹©è‡ªå·±çš„è´¦å·ç±»å‹ï¼Œè‹¥ç”³è¯·å¤šä¸ªå¹³å°ç™½åå•éœ€å¤šæ¬¡ç”³è¯·ï¼</p>
                            <p class="mb-0">åŸºå²©ç‰ˆXboxç©å®¶è‹¥ç”³è¯·åä»ä¸èƒ½è¿›å…¥ï¼Œè¯·å‰å¾€ç™»è®°Geyserè´¦å·ï¼š<a href="https://link.geysermc.org/" target="_blank" class="text-info">https://link.geysermc.org/</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è‡ªåŠ©æœåŠ¡ç³»ç»ŸåŒºåŸŸ -->
        <div class="row justify-content-center" id="serviceSystem" style="display: none;">
            <div class="col-md-8">
                <div class="content-box">
                    <h4>è‡ªåŠ©æœåŠ¡ç³»ç»Ÿ</h4>
                    <p>æ¬¢è¿ï¼Œ<span id="welcomePlayer"></span>ï¼ä»¥ä¸‹æ˜¯å¯ç”¨çš„è‡ªåŠ©æœåŠ¡åŠŸèƒ½ï¼š</p>
                    
                    <!-- æœåŠ¡å™¨åœ°å€ä¿¡æ¯ -->
                    <div class="mb-4">
                        <h5>ğŸ“ æœåŠ¡å™¨è¿æ¥åœ°å€</h5>
                        <div class="alert alert-minecraft">
                            <p><strong>Java Edition</strong></p>
                            <p class="mb-2">je.tecostudio.cn</p>
                            <p><strong>Bedrock Edition</strong></p>
                            <p><strong>åœ°å€ï¼š</strong>mc.lvss.xyz</p>
                            <p><strong>ç«¯å£ï¼š</strong>12002</p>
                        </div>
                    </div>
                    
                    <!-- æœåŠ¡å™¨çŠ¶æ€æŸ¥è¯¢ -->
                    <div class="mb-4">
                        <h5>1. æœåŠ¡å™¨çŠ¶æ€æŸ¥è¯¢</h5>
                        <button class="btn btn-info-minecraft" onclick="queryServerStatus()">æŸ¥è¯¢æœåŠ¡å™¨çŠ¶æ€</button>
                        <div id="serverStatus" class="mt-2"></div>
                    </div>

                    <!-- ç§å­æŸ¥è¯¢ -->
                    <div class="mb-4">
                        <h5>2. ä¸–ç•Œç§å­æŸ¥è¯¢</h5>
                        <button class="btn btn-info-minecraft" onclick="getSeed()">æŸ¥è¯¢ä¸–ç•Œç§å­</button>
                        <div id="seedResult" class="mt-2"></div>
                    </div>

                    <!-- æœåŠ¡å™¨é‡å¯ -->
                    <div class="mb-4">
                        <h5>3. æœåŠ¡å™¨è‡ªåŠ©é‡å¯</h5>
                        <p class="text-warning small">âš ï¸ æ³¨æ„ï¼šé‡å¯æœåŠ¡å™¨ä¼šæ–­å¼€æ‰€æœ‰åœ¨çº¿ç©å®¶çš„è¿æ¥ï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼</p>
                        <button class="btn btn-danger-minecraft" onclick="confirmRestart()">é‡å¯æœåŠ¡å™¨</button>
                        <div id="restartResult" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¯¼èˆªé“¾æ¥ -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="content-box text-center">
                    <a href="/" class="btn btn-minecraft me-2">è¿”å›é¦–é¡µ</a>
                    <a href="/survey" class="btn btn-minecraft">ç™½åå•ç”³è¯·</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPlayer = '';

        function showAlert(type, message, containerId) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-minecraft`;
            alertDiv.innerHTML = message;
            
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            container.appendChild(alertDiv);
        }

        function checkWhitelist() {
            const playerId = document.getElementById('playerIdInput').value.trim();
            if (!playerId) {
                showAlert('warning', 'è¯·è¾“å…¥æ‚¨çš„ Minecraft æ¸¸æˆIDï¼', 'whitelistResult');
                return;
            }

            const button = document.querySelector('button[onclick="checkWhitelist()"]');
            const originalText = button.textContent;
            button.textContent = 'æŸ¥è¯¢ä¸­...';
            button.disabled = true;

            fetch('/check_whitelist', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ player_id: playerId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    if (data.whitelisted) {
                        currentPlayer = data.player_id;
                        document.getElementById('welcomePlayer').textContent = currentPlayer;
                        showAlert('success', `æ­å–œï¼ç©å®¶ "${data.player_id}" åœ¨ç™½åå•ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è‡ªåŠ©æœåŠ¡åŠŸèƒ½ã€‚`, 'whitelistResult');
                        document.getElementById('serviceSystem').style.display = 'block';
                        // æ»šåŠ¨åˆ°è‡ªåŠ©æœåŠ¡ç³»ç»ŸåŒºåŸŸ
                        document.getElementById('serviceSystem').scrollIntoView({ behavior: 'smooth' });
                    } else {
                        showAlert('danger', `æŠ±æ­‰ï¼Œç©å®¶ "${data.player_id}" ä¸åœ¨ç™½åå•ä¸­ã€‚è¯·å…ˆå®Œæˆç™½åå•ç”³è¯·ã€‚`, 'whitelistResult');
                        document.getElementById('serviceSystem').style.display = 'none';
                    }
                } else {
                    showAlert('danger', data.message || 'æŸ¥è¯¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚', 'whitelistResult');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('danger', 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚', 'whitelistResult');
            })
            .finally(() => {
                button.textContent = originalText;
                button.disabled = false;
            });
        }

        function queryServerStatus() {
            const button = document.querySelector('button[onclick="queryServerStatus()"]');
            const originalText = button.textContent;
            button.textContent = 'æŸ¥è¯¢ä¸­...';
            button.disabled = true;

            fetch('/server_status')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success' && data.data) {
                    const info = data.data;
                    const serverAddress = data.server_address || 'æœªçŸ¥';
                    const statusHtml = `
                        <div class="alert alert-minecraft">
                            <h6>æœåŠ¡å™¨ä¿¡æ¯ï¼š</h6>
                            <p><strong>æœåŠ¡å™¨åœ°å€ï¼š</strong> ${serverAddress}</p>
                            <p><strong>ç‰ˆæœ¬ï¼š</strong> ${info.version || 'æœªçŸ¥'}</p>
                            <p><strong>åœ¨çº¿äººæ•°ï¼š</strong> <span class="status-online">${info.online || 0}</span> / ${info.max || 'æœªçŸ¥'}</p>
                            <p class="status-online">ğŸŸ¢ æœåŠ¡å™¨åœ¨çº¿</p>
                        </div>
                    `;
                    document.getElementById('serverStatus').innerHTML = statusHtml;
                } else {
                    showAlert('danger', 'æœåŠ¡å™¨ç¦»çº¿æˆ–æŸ¥è¯¢å¤±è´¥ã€‚', 'serverStatus');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('danger', 'æŸ¥è¯¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚', 'serverStatus');
            })
            .finally(() => {
                button.textContent = originalText;
                button.disabled = false;
            });
        }

        function getSeed() {
            const button = document.querySelector('button[onclick="getSeed()"]');
            const originalText = button.textContent;
            button.textContent = 'æŸ¥è¯¢ä¸­...';
            button.disabled = true;

            // ç›´æ¥æ˜¾ç¤ºç§å­ä¿¡æ¯
            const seedHtml = `
                <div class="alert alert-minecraft">
                    <h6>ä¸–ç•Œç§å­ï¼š</h6>
                    <p style="font-family: 'Courier New', monospace; font-size: 1.1em; color: #5cb85c;"><strong>-1940999848844551460</strong></p>
                </div>
            `;
            document.getElementById('seedResult').innerHTML = seedHtml;
            
            button.textContent = originalText;
            button.disabled = false;
        }

        function confirmRestart() {
            if (confirm('ç¡®å®šè¦é‡å¯æœåŠ¡å™¨å—ï¼Ÿè¿™å°†ä¼šæ–­å¼€æ‰€æœ‰åœ¨çº¿ç©å®¶çš„è¿æ¥ï¼')) {
                restartServer();
            }
        }

        function restartServer() {
            const button = document.querySelector('button[onclick="confirmRestart()"]');
            const originalText = button.textContent;
            button.textContent = 'é‡å¯ä¸­...';
            button.disabled = true;

            fetch('/restart_server', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('success', data.message, 'restartResult');
                } else {
                    showAlert('danger', data.message || 'é‡å¯å¤±è´¥ã€‚', 'restartResult');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('danger', 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚', 'restartResult');
            })
            .finally(() => {
                button.textContent = originalText;
                button.disabled = false;
            });
        }

        // å…è®¸ç”¨æˆ·æŒ‰å›è½¦é”®æŸ¥è¯¢ç™½åå•
        document.getElementById('playerIdInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkWhitelist();
            }
        });
    </script>
</body>
</html>
